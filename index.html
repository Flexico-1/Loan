<!doctype html>
<html lang="si">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Flexico Loan</title>
</head>
<body>
  <button id="loginBtn">‡∂á‡∂≠‡∑î‡∂Ω‡∑ä ‡∑Ä‡∂±‡∑ä‡∂±</button>
  <br><br>

  <label>‡∂´‡∂∫ ‡∂∏‡∑î‡∂Ø‡∂Ω: <span id="amountText">30,000</span></label><br>
  <input id="amountRange" type="range" min="30000" max="500000" step="1000" value="30000"><br>
  <div>‡∂∏‡∑è‡∑É‡∑í‡∂ö ‡∑Ä‡∑è‡∂ª‡∑í‡∂ö‡∂∫: <span id="monthlyValue">0</span></div>
  <div>‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂∏‡∑î‡∂Ø‡∂Ω: <span id="totalPayable">0</span></div>
  <div>‡∑Ä‡∑è‡∂ª‡∑í‡∂ö ‡∂ú‡∂´‡∂±: <span id="installmentsCount">-</span></div>
  <div>‡∂¥‡∑Ö‡∂∏‡∑î ‡∑Ä‡∑è‡∂ª‡∑í‡∂ö ‡∂Ø‡∑í‡∂±‡∂∫: <span id="firstDueDate">-</span></div>

  <script>
    const amountRange = document.getElementById('amountRange');
    const amountText = document.getElementById('amountText');
    const monthlyValue = document.getElementById('monthlyValue');
    const totalPayable = document.getElementById('totalPayable');
    const installmentsCount = document.getElementById('installmentsCount');
    const firstDueDate = document.getElementById('firstDueDate');

    const ANNUAL_RATE = 0.07;
    const MONTH_RATE = ANNUAL_RATE / 12;

    function getInstallmentMonths(amount){
      if (amount <= 80000) return 6;
      if (amount <= 120000) return 8;
      if (amount <= 200000) return 6;
      if (amount <= 300000) return 10;
      return 12;
    }

    function calculate(amount){
      const n = getInstallmentMonths(amount);
      const r = MONTH_RATE;
      const monthly = (r * amount) / (1 - Math.pow(1+r, -n));
      const total = monthly * n;
      return {monthly, total, n};
    }

    function addMonthsKeepDay(date, months) {
      const d = new Date(date);
      const day = d.getDate();
      d.setMonth(d.getMonth() + months);
      if (d.getDate() !== day) d.setDate(0);
      return d;
    }

    function updateAll(){
      const amt = Number(amountRange.value);
      amountText.textContent = amt.toLocaleString('en-US');
      const {monthly, total, n} = calculate(amt);
      monthlyValue.textContent = '‡∂ª‡∑î ' + Math.round(monthly).toLocaleString('en-US');
      totalPayable.textContent = '‡∂ª‡∑î ' + Math.round(total).toLocaleString('en-US');
      installmentsCount.textContent = n;
      const firstDue = addMonthsKeepDay(new Date(),1);
      firstDueDate.textContent = firstDue.toLocaleDateString('si-LK');
    }

    updateAll();
    amountRange.addEventListener('input', updateAll);

    // üîπ Language selector on Login
    document.getElementById('loginBtn').addEventListener('click', () => {
      const choice = confirm("Select your language:\n\nClick 'OK' for English\nClick 'Cancel' for ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω");
      if(choice){
        alert("You selected English ‚úÖ");
      } else {
        alert("‡∂î‡∂∫‡∑è ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω ‡∂≠‡∑ù‡∂ª‡∑è‡∂ú‡∂≠‡∑ä‡∂≠‡∑è ‚úÖ");
      }
    });
  </script>
</body>
</html>
